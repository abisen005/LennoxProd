<apex:page docType="html-5.0" Controller="dealerAccountPlanAggregate" standardStylesheets="false" showHeader="false" sidebar="false">
    
    <c:TrackPageView lenPageName="Territory Rollup Summary" />
    
    <style type="text/css">
        .customPopup { background-color: white; border: 2px solid #CC0000; z-index: 10001; left: 50%; padding:10px; position: absolute; width: 500px; margin-left: -250px; top:50px; } 
        .customForm { background-color: white; border: 2px solid #CC0000; z-index: 9999; left: 50%; padding:10px; position: absolute; width: 500px; margin-left: -250px; top:50px; }
        .popupBackground { background-color:black; opacity: 0.20; filter: alpha(opacity = 30); position: absolute; width: 100%; height: 100%; top: 0; left: 0; z-index: 9990; } 
        input[type=checkbox][disabled]{ color:black!important; }
        
        @media print { 
        a[href]:after { content: none !important;}
        .topSpace {margin-top:15px;}
        .aggregate table.table tr td {page-break-inside:avoid; page-break-after:always;} 
        
        }
        
    </style>
    <apex:form >
        <apex:outputPanel styleClass="customPopup" layout="block" rendered="{!invalidProfile}">
            <div class="bPageTitle" style="width:100%;">
                <div class="ptBody secondaryPalette" style="width:100%;">
                    <div class="content" style="width:100%;">
                        Only Territory Managers can access this page. Please contact System Admin for more information.<br/>Please &nbsp;<apex:commandLink value="click here" action="{!cancel}"></apex:commandLink>&nbsp; to close the window.
                        <div class="blank"></div>
                    </div>
                </div>
            </div>
        </apex:outputPanel>
        <apex:outputPanel rendered="{!invalidProfile == false}">
            <head>
                <title>TM Territory Roll-Up Summary</title>
                <apex:stylesheet value="{!$Resource.bootstrap}" />
                <apex:stylesheet value="{!$Resource.AccountPlanStyle}" />
                <style type="text/css">
                    @media all {
                    .page-break { display: none;  clear:both; page-break-after: always;}
                    }
                    @media print {
                    .page-break { display: block;/* page-break-before: always;*/ }
                    }
                    @page { margin: 1cm }
                </style>
            </head>
            <body onunload="window.opener.reload();" class="aggregate">
                <div class="container">
                    <div class="row hidden-print">
                        <c:printPDF invokedVFpageOrientation="Landscape" buttonClass="btn btn-small print pull-right" name="TM Territory Roll-Up Summary"  border="20px"/>
                    </div>
                    <div class="header">
                        
                        <h1 class="pull-right pad-right">Territory Roll-Up Summary - {!year}</h1>
                        <apex:image url="https://lennox.my.salesforce.com/servlet/servlet.ImageServer?id=015C0000002nCTp&oid=00D80000000LcQA" height="45" styleClass="header__logo pad-left" />
                    </div>
                    
                    <table class="table table-condensed highlight content-block">
                        <tr>
                            <td class="span9">
                                <h3 class="tm-header">
                                    {!u.FirstName} {!u.LastName} - {!u.District_Description_Formula__c} - {!u.SAP_Sales_Group__c}</h3>
                                <span style="tm-subheader">
                                    <apex:outputPanel ></apex:outputPanel></span>
                            </td>
                            <td class="span3">
                                <h3 class="text-right pad-right"> <span class="text-callout">
                                    <apex:outputText value="Report as of : {0,date,MM'/'dd'/'yyyy}">
                                        <apex:param value="{!lastSalesHistoryUpdate}" />
                                    </apex:outputText>
                                    </span></h3>
                            </td>
                        </tr>
                    </table>
                    
                    <table class="content-block" width="100%">
                        <tr>
                            <td class="span6 print5">
                                <table class="table table-bordered table-hover print-tbl">
                                    <tr>
                                        <th colspan="2" class="highlight">
                                            Dealer Sales History
                                        </th>
                                    </tr>
                                    <tr>
                                        <th class="text-left">{!preThreeYear} Sales</th>
                                        <td class="text-right"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!previousThreeYearsTotalSales}" /></apex:outputText></td>
                                    </tr>
                                    <tr>
                                        <th class="text-left">{!preTwoYear} Sales</th>
                                        <td class="text-right"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!previousTwoYearsTotalSales}" /></apex:outputText></td>
                                    </tr>
                                    
                                    <tr>
                                        <th class="text-left">{!preYear} Sales</th>
                                        <td class="text-right"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!previousYearTotalSales}" /></apex:outputText></td>
                                    </tr>
                                </table>
                            </td>
                            <td class="span6 print7">
                                <!--<h3 class="chart-title">Product Hierarchy</h3>-->
                                <div id="barchartTotal" align="right"></div>
                            </td>
                        </tr>
                    </table>
                    
                    
                    <table class="content-block" width="100%">
                        <tr>
                            <td class="span6 print5">
                                <table class="table table-bordered table-hover  print-tbl">
                                    <tr>
                                        <th class="highlight" colspan="2">YTD Sales Comparison</th>
                                    </tr>
                                    
                                    <tr>
                                        <th>{!year} Sales Forecast</th>
                                        <td class="text-right">
                                            <apex:outputText value="{0,number,$#,###}">
    <apex:param value="{!IF(ISNULL(presentYearSalesForecast), 0, presentYearSalesForecast)}" />
</apex:outputText>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>{!year}</th>
                                        <td class="text-right"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!ytdSales}" /></apex:outputText></td>
                                    </tr>
                                    <tr>
                                        <th>{!preYear}</th>
                                        <td class="text-right"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!previuosYearsYTDSales}" /></apex:outputText></td>
                                    </tr>
                                    <tr>
                                        <th>YoY Change</th>
                                        <td class="text-right js-change-amt" data-amt="{!ytdSalesChange}"><apex:outputText value="{0,number,$#,###.##}"><apex:param value="{!ytdSalesChange}" /></apex:outputText></td>
                                    </tr>
                                </table>
                            </td>
                            <td class="span6 print7">
                                <!--<h3 class="chart-title">Product Hierarchy</h3>-->
                                <div id="barchart" align="right"></div>
                            </td>
                        </tr>
                    </table>
                    <table class="content-block" width="100%">
                        <tr>
                            <td class="span6 print5">
                                <table class="table table-bordered ytd table-hover print-tbl">
                                    <tr>
                                        <th colspan="3" class="highlight">YTD Sales - Product Hierarchy</th>
                                    </tr>
                                    <tr>
                                        <th class="print8"><div style="width:10px; height:10px; background-color:#e74c3c;display:inline-block;" />&nbsp;&nbsp;Res Equipment </th>
                                        <td class="print4 text-right"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!ytdResEquipment}" /></apex:outputText></td>
                                        <td class="text-right"><span class="resEquipSales"></span></td>
                                    </tr>
                                    <tr>
                                        <th><div style="width:10px; height:10px; background-color:#2ECC71;display:inline-block;" />&nbsp;&nbsp;Commercial  </th>
                                        <td class="text-right"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!ytdCommercials}" /></apex:outputText></td>
                                        <td class="text-right"><span class="comSales"></span></td>
                                    </tr>
                                    <tr>
                                        <th><div style="width:10px; height:10px; background-color:#F1C40F;display:inline-block;" />&nbsp;&nbsp;Parts &amp; Supplies  </th>
                                        <td class="text-right"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!ytdPartsndSupplies}" /></apex:outputText></td>
                                        <td class="text-right"><span class="PSSales"></span></td>
                                    </tr>
                                </table>
                            </td>
                            <td class="span6 print7">
                                <!--<h3 class="chart-title">YTD Sales</h3>-->
                                <div id="piechart" align="right"></div>
                            </td>
                        </tr>
                    </table>
                    
                    <!--div class="page-break"></div-->
                    <div class="hide-for-web" style="height:30px"></div>

                    <table class="table table-bordered table-hover">
                        <tr>
                            <th colspan="6" class="highlight">YTD Sales - Product Tier</th>
                        </tr>
                        <tr>
                            <th>Product Tier</th>
                            <th class="text-center">{!year}</th>
                            <th class="text-center">% of Sales</th>
                            <th class="text-center">{!preYear}</th>
                            <th class="text-center">% of Sales</th>
                            <th class="text-center">Change</th>
                        </tr>
                        
                        <tr>
                            <td>DLSC</td>
                            <td class="text-right"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!presetDLSC}" /></apex:outputText></td>
                            <td class="text-right"><apex:outputText value="{0,number,##0.0}"><apex:param value="{!presetDLSCPercent}" /></apex:outputText>%</td>
                            <td class="text-right"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!previousYearDLSC}" /></apex:outputText></td>
                            <td class="text-right"><apex:outputText value="{0,number,##0.0}"><apex:param value="{!previousYearDLSCPercent}" /></apex:outputText>%</td>
                            <td class="text-right js-change-amt" data-amt="{!changeDLSC}"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!changeDLSC}" /></apex:outputText></td>
                        </tr>
                        
                        <tr>
                            <td>Elite</td>
                            <td class="text-right"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!presetElite}" /></apex:outputText></td>
                            <td class="text-right"><apex:outputText value="{0,number,##0.0}"><apex:param value="{!presetElitePercent}" /></apex:outputText>%</td>
                            <td class="text-right"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!previousYearElite}" /></apex:outputText></td>
                            <td class="text-right"><apex:outputText value="{0,number,##0.0}"><apex:param value="{!previousYearElitePercent}" /></apex:outputText>%</td>
                            <td class="text-right js-change-amt" data-amt="{!changeElite}"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!changeElite}" /></apex:outputText></td>
                        </tr>
                        
                        <tr>
                            <td>Merit</td>
                            <td class="text-right"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!presetMerit}" /></apex:outputText></td>
                            <td class="text-right"><apex:outputText value="{0,number,##0.0}"><apex:param value="{!presetMeritPercent}" /></apex:outputText>%</td>
                            <td class="text-right"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!previousYearMerit}" /></apex:outputText></td>
                            <td class="text-right"><apex:outputText value="{0,number,##0.0}"><apex:param value="{!previousYearMeritPercent}" /></apex:outputText>%</td>
                            <td class="text-right js-change-amt" data-amt="{!changeMerit}"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!changeMerit}" /></apex:outputText></td>
                        </tr>
                        
                        <!--tr>
                            <td>Aire-Flo</td>
                            <td class="text-right"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!presetAireFlo}" /></apex:outputText></td>
                            <td class="text-right"><apex:outputText value="{0,number,##0.0}"><apex:param value="{!presetAireFloPercent}" /></apex:outputText>%</td>
                            <td class="text-right"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!previousYearAireFlo}" /></apex:outputText></td>
                            <td class="text-right"><apex:outputText value="{0,number,##0.0}"><apex:param value="{!previousYearAireFloPercent}" /></apex:outputText>%</td>
                            <td class="text-right js-change-amt" data-amt="{!changeAireFlo}"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!changeAireFlo}" /></apex:outputText></td>
                        </tr-->
                        
                        <tr>
                            <td>Other</td>
                            <td class="text-right"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!presetOther}" /></apex:outputText></td>
                            <td class="text-right"><apex:outputText value="{0,number,##0.0}"><apex:param value="{!presentYearOtherPercent}" /></apex:outputText>%</td>
                            <td class="text-right"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!previousYearOther}" /></apex:outputText></td>
                            <td class="text-right"><apex:outputText value="{0,number,##0.0}"><apex:param value="{!previousYearOtherPercent}" /></apex:outputText>%</td>
                            <td class="text-right js-change-amt" data-amt="{!changeOther}"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!changeOther}" /></apex:outputText></td>
                        </tr>
                    </table>
                    <div class="page-break"></div>
                    <div class="hide-for-web" style="height:30px"></div>
                </div>
                
                <div class="container">
                    <!-- ------------------------------------------------GROWTH DEALERS SECTION-------------------------------------------------- -->
                    <table width="100%" border="0" cellspacing="0" cellpadding="0" class="table table-bordered table-hover">
                        <tr >
                            <td class="highlight" colspan="9" style="text-align:left;">
                                <h3 class="pad-left">Growth Dealers</h3>
                            </td>
                        </tr>
                        <tr>
                            <th width="22%" scope="col" style="text-align:center;vertical-align: middle">Dealer</th>
                            <th scope="col" style="text-align:center;vertical-align: middle">Customer Number</th>
                            <th scope="col" style="text-align:center;vertical-align: middle" class="hide-for-print">New Customer</th>
                              <th scope="col" style="text-align:center;vertical-align: middle">Sales Forecast</th>
                            <th scope="col" style="text-align:center;vertical-align: middle">YTD Sales(Local Currency)</th>
                            <th scope="col" style="text-align:center;vertical-align: middle">Delta YTD Sales Year To Year</th>
                            <th scope="col" style="text-align:center;vertical-align: middle">{!preYear} Total Sales</th>
                            <th scope="col" style="text-align:center;vertical-align: middle">{!preTwoYear} Total Sales</th>
                            <!--th scope="col" style="text-align:center;vertical-align: middle">{!preThreeYear} Total Sales</th-->
                            <th scope="col" style="text-align:center;vertical-align: middle">Last Activity</th>
                        </tr>
                        <apex:repeat var="dp" value="{!wrapListPositive}">
                            <tr>
                                <!--td style="text-align:left;"><a class="link-to-sobject" id="{!dp.dealerId}" href="#" >{!dp.dealerName}</a></td-->
                                 <td style="text-align:left;">   
                                   <apex:outputLink value="{!URLFOR($Action.Account.View, dp.dealerId)}" target="_blank"  >{!dp.dealerName}</apex:outputLink>                   
                                </td>
                                <td style="text-align:center;">{!dp.dealerCustNo}</td>
                                <td style="text-align:center;color:black" class="hide-for-print"><apex:inputCheckbox value="{!dp.newCustomer}" style="color:black" onclick="{return false}" /></td>
                                 <td style="text-align:right;"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!dp.salesForecast}" /></apex:outputText></td>
                                <td style="text-align:right;"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!dp.dealerYTDSalesLC}" /></apex:outputText></td>
                                <td style="text-align:right;"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!dp.dealerDeltAYTDSales}" /></apex:outputText></td>
                                <td style="text-align:right;"><apex:outputText value="{0,number,$#,###}" ><apex:param value="{!dp.dealerPre1TS}" /></apex:outputText></td>
                                <td style="text-align:right;"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!dp.dealerPre2TS}" /></apex:outputText></td>
                                <!--td style="text-align:right;"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!dp.dealerPre3TS}" /></apex:outputText></td-->
                                <td style="text-align:right;">
                                    <apex:outputText value="{0,date,MM'/'dd'/'yyyy}">
                                        <apex:param value="{!dp.dealerLastAct}" />
                                    </apex:outputText>
                                </td>
                            </tr>
                        </apex:repeat>
                        <tr>
                            <td style="text-align:left;"><b>Total</b></td>
                            <td style="text-align:center;"></td>
                            <td style="text-align:center;" class="hide-for-print"></td>
                              <td style="text-align:right;"><b><apex:outputText value="{0,number,$#,###}"><apex:param value="{!totalSalesForecastGrowth}" /></apex:outputText></b></td>
                            <td style="text-align:right;"><b><apex:outputText value="{0,number,$#,###}"><apex:param value="{!dealerYTDSalesLCSum1}" /></apex:outputText></b></td>
                            <td style="text-align:right;"><b><apex:outputText value="{0,number,$#,###}"><apex:param value="{!dealerDeltAYTDSalesSum1}" /></apex:outputText></b></td>
                            <td style="text-align:right;"><b><apex:outputText value="{0,number,$#,###}"><apex:param value="{!dealerpre1TSSum1}" /></apex:outputText></b></td>
                            <td style="text-align:right;"><b><apex:outputText value="{0,number,$#,###}"><apex:param value="{!dealerPre2TSSum1}" /></apex:outputText></b></td>
                            <!--td style="text-align:right;"><b><apex:outputText value="{0,number,$#,###}"><apex:param value="{!dealerPre3TSSum1}" /></apex:outputText></b></td-->
                            <td style="text-align:center;">
                                
                            </td>
                        </tr>
                    </table>
                    <div class="page-break"></div>
                    <div class="hide-for-web" style="height:30px"></div>
                    <!-- ------------------------------------------------------ATTRITION DEALERS----------------------------------------------------- -->
                    <table width="100%" border="0" cellspacing="0" cellpadding="0" class="table table-bordered table-hover">
                        <tr >
                            <td class="highlight" colspan="9" style="text-align:left;">
                                <h3 class="pad-left">Attrition Dealers</h3>
                            </td>
                        </tr>
                        <tr>
                            <th width="22%" scope="col" style="text-align:center;vertical-align: middle">Dealer</th>
                            <th scope="col" style="text-align:center;vertical-align: middle">Customer Number</th>
                            <!--<th width="10%" scope="col" style="text-align:center;vertical-align: middle">Territory#</th>-->
                            <!--<th width="10%" scope="col" style="text-align:center;vertical-align: middle">FG Price Zone</th>-->
                            <th scope="col" style="text-align:center;vertical-align: middle" class="hide-for-print">New Customer</th>
                            <th scope="col" style="text-align:center;vertical-align: middle" >Sales Forecast</th>
                            <th scope="col" style="text-align:center;vertical-align: middle">YTD Sales(Local Currency)</th>
                            <th scope="col" style="text-align:center;vertical-align: middle">Delta YTD Sales Year To Year</th>
                            <th scope="col" style="text-align:center;vertical-align: middle">{!preYear} Total Sales</th>
                            <th scope="col" style="text-align:center;vertical-align: middle">{!preTwoYear} Total Sales</th>
                            <!--th scope="col" style="text-align:center;vertical-align: middle">{!preThreeYear} Total Sales</th-->
                            <th scope="col" style="text-align:center;vertical-align: middle">Last Activity</th>
                        </tr>
                        <apex:repeat var="dp" value="{!wrapListNegative}">
                            <tr>
 <td style="text-align:left;">   
                                   <apex:outputLink value="{!URLFOR($Action.Account.View, dp.dealerId)}" target="_blank"  >{!dp.dealerName}</apex:outputLink>                   
                                </td>                                <td style="text-align:center;">{!dp.dealerCustNo}</td>
                                <!--<td width="10%" style="text-align:center;">{!dp.dealerTerritory}</td>-->
                                <!--<td width="10%" style="text-align:center;">{!dp.dealerFGPrizeZone}</td>-->
                                <td style="text-align:center;" class="hide-for-print"><apex:inputCheckbox value="{!dp.newCustomer}" onclick="{return false}"/></td>
                                 <td style="text-align:right;"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!dp.salesForecast}" /></apex:outputText></td>
                                <td style="text-align:right;"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!dp.dealerYTDSalesLC}" /></apex:outputText></td>
                                <td style="text-align:right;"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!dp.dealerDeltAYTDSales}" /></apex:outputText></td>
                                <td style="text-align:right;"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!dp.dealerPre1TS}" /></apex:outputText></td>
                                <td style="text-align:right;"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!dp.dealerPre2TS}" /></apex:outputText></td>
                                <!--td style="text-align:right;"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!dp.dealerPre3TS}" /></apex:outputText></td-->
                                <td style="text-align:right;">
                                    <apex:outputText value="{0,date,MM'/'dd'/'yyyy}">
                                        <apex:param value="{!dp.dealerLastAct}"/>
                                    </apex:outputText>
                                </td>
                            </tr>
                        </apex:repeat>
                        <tr>
                            <td style="text-align:left;"><b>Total</b></td>
                            <td style="text-align:center;"></td>
                            <!--<td width="10%" style="text-align:center;">{!dp.dealerTerritory}</td>-->
                            <!--<td width="10%" style="text-align:center;">{!dp.dealerFGPrizeZone}</td>-->
                            <td style="text-align:center;" class="hide-for-print"></td>
                                                        <td style="text-align:right;"><b><apex:outputText value="{0,number,$#,###}"><apex:param value="{!totalSalesForecastAttrition}" /></apex:outputText></b></td>
                            <td style="text-align:right;"><b><apex:outputText value="{0,number,$#,###}"><apex:param value="{!dealerYTDSalesLCSum2}" /></apex:outputText></b></td>
                            <td style="text-align:right;"><b><apex:outputText value="{0,number,$#,###}"><apex:param value="{!dealerDeltAYTDSalesSum2}" /></apex:outputText></b></td>
                            <td style="text-align:right;"><b><apex:outputText value="{0,number,$#,###}"><apex:param value="{!dealerpre1TSSum2}" /></apex:outputText></b></td>
                            <td style="text-align:right;"><b><apex:outputText value="{0,number,$#,###}"><apex:param value="{!dealerPre2TSSum2}" /></apex:outputText></b></td>
                            <!--td style="text-align:right;"><b><apex:outputText value="{0,number,$#,###}"><apex:param value="{!dealerPre3TSSum2}" /></apex:outputText></b></td-->
                            <td style="text-align:center;">
                            </td>
                        </tr>
                    </table>
                    
                    <div class="page-break"></div>
                    <div class="hide-for-web" style="height:30px"></div>
                    <!-- ------------------------------------------------ACCOUNT OPPORTUNITIES--------------------------------------------------- -->
                    
                    <apex:outputPanel rendered="{!displayCompletedAccOpty || displayInProgressAccOpty || displayCancelledAccOpty || displayNotStartedAccOpty}">
                        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="table table-bordered table-hover" >
                            <tr >
                                <td class="highlight" colspan="6" style="text-align:left;">
                                    <h3 class="pad-left ">Account Opportunities</h3>
                      
                                </td>
                            </tr>
                            <tr style="{!IF(!displayInProgressAccOpty,'display:none','')}">
                                <td colspan="6" style="background-color:#F9F3DF;height:1px;">
                                    <span style="font-size:12px;text-align:left;"><b>Opportunity Status:</b> In Progress<b> ({!accOppProgCount} records)</b></span>
                                </td>
                            </tr>
                            <tr style="{!IF(!displayInProgressAccOpty,'display:none','')}">
                                <th width="12%" scope="col" style="text-align:center;vertical-align: middle">Account Plan </th>
                                <th width="11%" scope="col" style="text-align:center;vertical-align: middle">Account Opportunity Number </th>
                                <th width="14%" scope="col" style="text-align:center;vertical-align: middle">Opportunity Type </th>
                                <th width="39%" scope="col" style="text-align:center;vertical-align: middle">Opportunity Notes </th>
                                <th width="12%" scope="col" style="text-align:center;vertical-align: middle">Adjusted Value </th>
                                <th width="12%" scope="col" style="text-align:center;vertical-align: middle">Expected Value </th>
                            </tr>
                            <apex:repeat var="ao" value="{!accountOppProgress}" rendered="{!displayInProgressAccOpty}">
                                <tr>
                                    <td width="12%" style="text-align:left;"><a class="link-to-sobject" id="{!ao.Dealer_Account_Plan__c}" href="#" >{!ao.Dealer_Account_Plan__r.Name}</a></td>
                                    <td width="11%" style="text-align:center;"><apex:outputlink value="/{!ao.Id}">{!ao.Name}</apex:outputlink></td>
                                    <td width="14%" style="text-align:center;">{!ao.Opportunity_Type__c}</td>
                                    <td width="39%" style="text-wrap:suppress;text-align:center;">{!ao.Opportunity_Notes__c}</td>
                                    <td width="12%" style="text-align:right;"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!ao.Adjusted_Value__c}" /></apex:outputText></td>
                                    <td width="12%" style="text-align:right;"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!ao.Expected_Value__c}" /></apex:outputText></td>
                                </tr>
                            </apex:repeat>
                            <tr>
                                <td width="12%" style="text-align:left;"><b>Total</b></td>
                                <td width="11%" style="text-align:left;"></td>
                                <td width="14%" style="text-align:left;"></td>
                                <td width="39%" style="text-wrap:suppress;text-align:left;"></td>
                                <td width="12%" style="text-align:right;"><b><apex:outputText value="{0,number,$#,###}"><apex:param value="{!progressAccOptyAdj}" /></apex:outputText></b></td>
                                <td width="12%" style="text-align:right;"><b><apex:outputText value="{0,number,$#,###}"><apex:param value="{!progressAccOpty}" /></apex:outputText></b></td>
                            </tr>
                            <!--</apex:panelGrid>-->
                        </table>
                    <div class="page-break"></div>
                    <div class="hide-for-web" style="height:30px"></div>
                    </apex:outputPanel>
                    
                    <apex:outputPanel rendered="{!displayNotStartedAccOpty}">
                        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="table table-bordered table-hover">
                            <tr>
                                <td colspan="6" style="background-color:#F9F3DF;">
                                    <span style="font-size:12px;text-align:left;"><b>Opportunity Status:</b> Not Started<b> ({!accountOppNotStartedCount} records)</b></span>
                                </td>
                            </tr>
                            <tr>
                                <th width="12%" scope="col" style="text-align:center;vertical-align: middle">Account Plan </th>
                                <th width="11%" scope="col" style="text-align:center;vertical-align: middle">Account Opportunity Number </th>
                                <th width="14%" scope="col" style="text-align:center;vertical-align: middle">Opportunity Type </th>
                                <th width="39%" scope="col" style="text-align:center;vertical-align: middle">Opportunity Notes </th>
                                <th width="12%" scope="col" style="text-align:center;vertical-align: middle">Adjusted Value </th>
                                <th width="12%" scope="col" style="text-align:center;vertical-align: middle">Expected Value </th>
                            </tr>
                            
                            <!--<apex:panelGrid columns="5" id="theGrid2">-->
                            <apex:repeat var="ao" value="{!accountOppNotStarted}">
                                <tr>
                                    <td width="12%" style="text-align:left;"><a class="link-to-sobject" id="{!ao.Dealer_Account_Plan__c}" href="/{!ao.Dealer_Account_Plan__c}" >{!ao.Dealer_Account_Plan__r.Name}</a></td>
                                    <td width="11%" style="text-align:center;"><apex:outputlink value="/{!ao.Id}">{!ao.Name}</apex:outputlink></td>
                                    <td width="14%" style="text-align:center;">{!ao.Opportunity_Type__c}</td>
                                    <td width="39%" style="text-wrap:suppress;text-align:center;">{!ao.Opportunity_Notes__c}</td>
                                    <td width="12%" style="text-align:right;"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!ao.Adjusted_Value__c}" /></apex:outputText></td>
                                    <td width="12%" style="text-align:right;"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!ao.Expected_Value__c}" /></apex:outputText></td>
                                </tr>
                            </apex:repeat>
                            <tr>
                                <td width="14%" style="text-align:left;"><b>Total</b></td>
                                <td width="13%" style="text-align:left;"></td>
                                <td width="16%" style="text-align:left;"></td>
                                <td width="43%" style="text-wrap:suppress;text-align:left;"></td>
                                <td width="14%" style="text-align:right;"><b><apex:outputText value="{0,number,$#,###}"><apex:param value="{!notStartedAccOptyAdj}" /></apex:outputText></b></td>
                                <td width="12%" style="text-align:right;"><b><apex:outputText value="{0,number,$#,###}"><apex:param value="{!notStartedAccOpty}" /></apex:outputText></b></td>
                            </tr>
                            <!--</apex:panelGrid>-->
                        </table>
                        <div class="page-break"></div>
                        <div class="hide-for-web" style="height:30px"></div>
                    </apex:outputPanel>
                    
                    <apex:outputPanel rendered="{!displayHoldAccOpty}">
                        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="table table-bordered table-hover">
                            <tr>
                                <td colspan="6" style="background-color:#F9F3DF;">
                                    <span style="font-size:12px;text-align:left;"><b>Opportunity Status:</b> On Hold<b> ({!accountOppHoldCount} records)</b></span>
                                </td>
                            </tr>
                            <tr>
                                <th width="12%" scope="col" style="text-align:center;vertical-align: middle">Account Plan </th>
                                <th width="11%" scope="col" style="text-align:center;vertical-align: middle">Account Opportunity Number </th>
                                <th width="14%" scope="col" style="text-align:center;vertical-align: middle">Opportunity Type </th>
                                <th width="39%" scope="col" style="text-align:center;vertical-align: middle">Opportunity Notes </th>
                                <th width="12%" scope="col" style="text-align:center;vertical-align: middle">Adjusted Value </th>
                                <th width="12%" scope="col" style="text-align:center;vertical-align: middle">Expected Value </th>
                            </tr>
                            
                            <!--<apex:panelGrid columns="5" id="theGrid2">-->
                            <apex:repeat var="ao" value="{!accountOppHold}">
                                <tr>
                                    <td width="12%" style="text-align:left;"><a class="link-to-sobject" id="{!ao.Dealer_Account_Plan__c}" href="#" >{!ao.Dealer_Account_Plan__r.Name}</a></td>
                                    <td width="11%" style="text-align:center;"><apex:outputlink value="/{!ao.Id}">{!ao.Name}</apex:outputlink></td>
                                    <td width="14%" style="text-align:center;">{!ao.Opportunity_Type__c}</td>
                                    <td width="39%" style="text-wrap:suppress;text-align:center;">{!ao.Opportunity_Notes__c}</td>
                                    <td width="12%" style="text-align:right;"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!ao.Adjusted_Value__c}" /></apex:outputText></td>
                                    <td width="12%" style="text-align:right;"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!ao.Expected_Value__c}" /></apex:outputText></td>
                                </tr>
                            </apex:repeat>
                            <tr>
                                <td width="14%" style="text-align:left;"><b>Total</b></td>
                                <td width="13%" style="text-align:left;"></td>
                                <td width="16%" style="text-align:left;"></td>
                                <td width="43%" style="text-wrap:suppress;text-align:left;"></td>
                                <td width="14%" style="text-align:right;"><b><apex:outputText value="{0,number,$#,###}"><apex:param value="{!holdAccOptyAdj}" /></apex:outputText></b></td>
                                <td width="12%" style="text-align:right;"><b><apex:outputText value="{0,number,$#,###}"><apex:param value="{!holdAccOpty}" /></apex:outputText></b></td>
                            </tr>
                            <!--</apex:panelGrid>-->
                        </table>
                        <div class="page-break"></div>
                        <div class="hide-for-web" style="height:30px"></div>
                    </apex:outputPanel>
                    
                    <apex:outputPanel rendered="{!displayCompletedAccOpty}">
                        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="table table-bordered table-hover topSpace">
                            <tr>
                                <td colspan="6" style="background-color:#F9F3DF;">
                                    <span style="font-size:12px;text-align:left;"><b>Opportunity Status:</b> Completed<b> ({!accountOppCompletedCount} records)</b></span>
                                </td>
                            </tr>
                            <tr>
                                <th width="12%" scope="col" style="text-align:center;vertical-align: middle">Account Plan </th>
                                <th width="11%" scope="col" style="text-align:center;vertical-align: middle">Account Opportunity Number </th>
                                <th width="14%" scope="col" style="text-align:center;vertical-align: middle">Opportunity Type </th>
                                <th width="39%" scope="col" style="text-align:center;vertical-align: middle">Opportunity Notes </th>
                                <th width="12%" scope="col" style="text-align:center;vertical-align: middle">Adjusted Value </th>
                                <th width="12%" scope="col" style="text-align:center;vertical-align: middle">Expected Value </th>
                            </tr>
                            
                            <!--<apex:panelGrid columns="5" id="theGrid2">-->
                            <apex:repeat var="ao" value="{!accountOppCompleted}">
                                <tr>
                                    <td width="12%" style="text-align:left;"><a class="link-to-sobject" id="{!ao.Dealer_Account_Plan__c}" href="#" >{!ao.Dealer_Account_Plan__r.Name}</a></td>
                                    <td width="11%" style="text-align:center;"><apex:outputlink value="/{!ao.Id}">{!ao.Name}</apex:outputlink></td>
                                    <td width="14%" style="text-align:center;">{!ao.Opportunity_Type__c}</td>
                                    <td width="39%" style="text-wrap:suppress;text-align:center;">{!ao.Opportunity_Notes__c}</td>
                                    <td width="12%" style="text-align:right;"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!ao.Adjusted_Value__c}" /></apex:outputText></td>
                                    <td width="12%" style="text-align:right;"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!ao.Expected_Value__c}" /></apex:outputText></td>
                                </tr>
                            </apex:repeat>
                            <tr>
                                <td width="14%" style="text-align:left;"><b>Total</b></td>
                                <td width="13%" style="text-align:left;"></td>
                                <td width="16%" style="text-align:left;"></td>
                                <td width="43%" style="text-wrap:suppress;text-align:left;"></td>
                                <td width="14%" style="text-align:right;"><b><apex:outputText value="{0,number,$#,###}"><apex:param value="{!completedAccOptyAdj}" /></apex:outputText></b></td>
                                <td width="12%" style="text-align:right;"><b><apex:outputText value="{0,number,$#,###}"><apex:param value="{!completedAccOpty}" /></apex:outputText></b></td>
                            </tr>
                            <!--</apex:panelGrid>-->
                        </table>
                        <div class="page-break"></div>
                        <div class="hide-for-web" style="height:30px"></div>
                    </apex:outputPanel>
                    
                    <apex:outputPanel rendered="{!displayCancelledAccOpty}">
                        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="table table-bordered table-hover">
                            <tr>
                                <td colspan="6" style="background-color:#F9F3DF;">
                                    <span style="font-size:12px;text-align:left;"><b>Opportunity Status:</b> Cancelled<b> ({!accountOppCancelledCount} records)</b></span>
                                </td>
                            </tr>
                            <tr>
                                <th width="12%" scope="col" style="text-align:center;vertical-align: middle">Account Plan </th>
                                <th width="11%" scope="col" style="text-align:center;vertical-align: middle">Account Opportunity Number </th>
                                <th width="14%" scope="col" style="text-align:center;vertical-align: middle">Opportunity Type </th>
                                <th width="39%" scope="col" style="text-align:center;vertical-align: middle">Opportunity Notes </th>
                                <th width="12%" scope="col" style="text-align:center;vertical-align: middle">Adjusted Value </th>
                                <th width="12%" scope="col" style="text-align:center;vertical-align: middle">Expected Value </th>
                            </tr>
                            
                            <!--<apex:panelGrid columns="5" id="theGrid2">-->
                            <apex:repeat var="ao" value="{!accountOppCancelled}">
                                <tr>
                                    <td width="12%" style="text-align:left;"><a class="link-to-sobject" id="{!ao.Dealer_Account_Plan__c}" href="#" >{!ao.Dealer_Account_Plan__r.Name}</a></td>
                                    <td width="11%" style="text-align:center;"><apex:outputlink value="/{!ao.Id}">{!ao.Name}</apex:outputlink></td>
                                    <td width="14%" style="text-align:center;">{!ao.Opportunity_Type__c}</td>
                                    <td width="39%" style="text-wrap:suppress;text-align:center;">{!ao.Opportunity_Notes__c}</td>
                                    <td width="12%" style="text-align:right;"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!ao.Adjusted_Value__c}" /></apex:outputText></td>
                                    <td width="12%" style="text-align:right;"><apex:outputText value="{0,number,$#,###}"><apex:param value="{!ao.Expected_Value__c}" /></apex:outputText></td>
                                </tr>
                            </apex:repeat>
                            <tr>
                                <td width="14%" style="text-align:left;"><b>Total</b></td>
                                <td width="13%" style="text-align:left;"></td>
                                <td width="16%" style="text-align:left;"></td>
                                <td width="43%" style="text-wrap:suppress;text-align:left;"></td>
                                <td width="14%" style="text-align:right;"><b><apex:outputText value="{0,number,$#,###}"><apex:param value="{!cancelledAccOptyAdj}" /></apex:outputText></b></td>
                                <td width="12%" style="text-align:right;"><b><apex:outputText value="{0,number,$#,###}"><apex:param value="{!cancelledAccOpty}" /></apex:outputText></b></td>
                            </tr>
                            <!--</apex:panelGrid>-->
                        </table>
                        <div class="page-break"></div>
                        <div class="hide-for-web" style="height:30px"></div>
                    </apex:outputPanel>
                    
                    
                    <!-- -----------------------------------------------------RETENTION OPPORTUNITIES----------------------------------------------- -->
                    <apex:outputPanel rendered="{!displayRetentionOppProgress || displayRetentionOppCompleted || displayRetentionOppNotStarted || displayRetentionOppCancelled}">
                        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="table table-bordered table-hover">
                            <tr>
                                <td class="highlight" colspan="5" style="text-align:left;">
                                    <h3 class="pad-left">Retention Opportunities</h3>
                                </td>
                            </tr>
                            <tr style="{!IF(!displayRetentionOppProgress,'display:none','')}">
                                <td colspan="5" style="background-color:#F9F3DF;">
                                    <span style="font-size:12px;text-align:left;"><b>Retention Opportunity Status:</b> In Progress<b> ({!retOppProgCount} records)</b></span>
                                    
                                </td>
                            </tr>
                            <tr style="{!IF(!displayRetentionOppProgress,'display:none','')}">
                                <th width="14%" scope="col" style="text-align:center;vertical-align: middle">Account Plan </th>
                                <th width="13%" scope="col" style="text-align:center;vertical-align: middle">Retention Opportunity Number </th>
                                <th width="16%" scope="col" style="text-align:center;vertical-align: middle">Retention Opportunity Type </th>
                                <th width="43%" scope="col" style="text-align:center;vertical-align: middle">Retention Opportunity</th>
                                <th width="14%" scope="col" style="text-align:center;vertical-align: middle">Potential CRI Points</th>
                            </tr>
                            <apex:repeat var="ao" value="{!retentionOppProgress}" rendered="{!displayRetentionOppProgress}">
                                <tr>
                                    <td width="14%" style="text-align:left;"><a class="link-to-sobject" id="{!ao.accPlanId}" href="#" >{!ao.accPlanName}</a></td>
                                    <td width="13%" style="text-align:center;"><a class="link-to-sobject" id="{!ao.retOptyId}" href="#" >{!ao.retOptyNum}</a></td>
                                    <td width="16%" style="text-align:center;">{!ao.retOptyType}</td>
                                    <td width="43%" style="text-wrap:suppress;text-align:center;">{!ao.retOpty}</td>
                                    <td width="14%" style="text-align:right;">{!ao.potenCRIPts}</td>
                                </tr>
                            </apex:repeat>
                            <tr>
                                <td width="14%" style="text-align:left;"><b>Total</b></td>
                                <td width="13%" style="text-align:left;"></td>
                                <td width="16%" style="text-align:left;"></td>
                                <td width="43%" style="text-wrap:suppress;text-align:left;"></td>
                                <td width="14%" style="text-align:right;"><b>{!progressRetOpty}</b></td>
                            </tr>
                        </table>
                        <div class="page-break"></div>
                        <div class="hide-for-web" style="height:30px"></div>
                    </apex:outputPanel>
                    
                    <apex:outputPanel rendered="{!displayRetentionOppNotStarted}">
                        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="table table-bordered table-hover">
                            <tr>
                                <td colspan="5" style="background-color:#F9F3DF;">
                                    <span style="font-size:12px;text-align:left;"><b>Retention Opportunity Status:</b> Not Started<b> ({!retOppNotStartedCount} records)</b></span>
                                    
                                </td>
                            </tr>
                            <tr>
                                <th width="14%" scope="col" style="text-align:center;vertical-align: middle">Account Plan </th>
                                <th width="13%" scope="col" style="text-align:center;vertical-align: middle">Retention Opportunity Number </th>
                                <th width="16%" scope="col" style="text-align:center;vertical-align: middle">Retention Opportunity Type </th>
                                <th width="43%" scope="col" style="text-align:center;vertical-align: middle">Retention Opportunity</th>
                                <th width="14%" scope="col" style="text-align:center;vertical-align: middle">Potential CRI Points</th>
                            </tr>
                            <apex:repeat var="ao" value="{!retentionOppNotStarted}">
                                <tr>
                                    <td width="14%" style="text-align:left;"><a class="link-to-sobject" id="{!ao.accPlanId}" href="#" >{!ao.accPlanName}</a></td>
                                    <td width="13%" style="text-align:center;"><a class="link-to-sobject" id="{!ao.retOptyId}" href="#" >{!ao.retOptyNum}</a></td>                    <td width="13%" style="text-align:center;"><apex:outputlink target="_blank" value="/{!ao.retOptyId}">{!ao.retOptyNum}</apex:outputlink></td>
                                    <td width="16%" style="text-align:center;">{!ao.retOptyType}</td>
                                    <td width="43%" style="text-wrap:suppress;text-align:center;">{!ao.retOpty}</td>
                                    <td width="14%" style="text-align:right;">{!ao.potenCRIPts}</td>
                                </tr>
                            </apex:repeat>
                            <tr>
                                <td width="14%" style="text-align:left;"><b>Total</b></td>
                                <td width="13%" style="text-align:left;"></td>
                                <td width="16%" style="text-align:left;"></td>
                                <td width="43%" style="text-wrap:suppress;text-align:left;"></td>
                                <td width="14%" style="text-align:right;"><b>{!notStartedRetOpty}</b></td>
                            </tr>
                        </table>
                        <div class="page-break"></div>
                        <div class="hide-for-web" style="height:30px"></div>
                    </apex:outputPanel>
                    
                    <apex:outputPanel rendered="{!displayRetentionOppCompleted}">
                        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="table table-bordered table-hover">
                            <tr>
                                <td colspan="5" style="background-color:#F9F3DF;">
                                    <span style="font-size:12px;text-align:left;"><b>Retention Opportunity Status:</b> Completed<b> ({!retOppCompletedCount} records)</b></span>
                                    
                                </td>
                            </tr>
                            <tr>
                                <th width="14%" scope="col" style="text-align:center;vertical-align: middle">Account Plan </th>
                                <th width="13%" scope="col" style="text-align:center;vertical-align: middle">Retention Opportunity Number </th>
                                <th width="16%" scope="col" style="text-align:center;vertical-align: middle">Retention Opportunity Type </th>
                                <th width="43%" scope="col" style="text-align:center;vertical-align: middle">Retention Opportunity</th>
                                <th width="14%" scope="col" style="text-align:center;vertical-align: middle">Potential CRI Points</th>
                            </tr>
                            <apex:repeat var="ao" value="{!retentionOppCompleted}">
                                <tr>
                                    <td width="14%" style="text-align:left;"><a class="link-to-sobject" id="{!ao.accPlanId}" href="#" >{!ao.accPlanName}</a></td>
                                    <td width="13%" style="text-align:center;"><a class="link-to-sobject" id="{!ao.retOptyId}" href="#" >{!ao.retOptyNum}</a></td>
                                    <td width="16%" style="text-align:center;">{!ao.retOptyType}</td>
                                    <td width="43%" style="text-wrap:suppress;text-align:center;">{!ao.retOpty}</td>
                                    <td width="14%" style="text-align:right;">{!ao.potenCRIPts}</td>
                                </tr>
                            </apex:repeat>
                            <tr>
                                <td width="14%" style="text-align:left;"><b>Total</b></td>
                                <td width="13%" style="text-align:left;"></td>
                                <td width="16%" style="text-align:left;"></td>
                                <td width="43%" style="text-wrap:suppress;text-align:left;"></td>
                                <td width="14%" style="text-align:right;"><b>{!completedRetOpty}</b></td>
                            </tr>
                        </table>
                        <div class="page-break"></div>
                        <div class="hide-for-web" style="height:30px"></div>
                    </apex:outputPanel>
                    
                    <apex:outputPanel rendered="{!displayRetentionOppCancelled}">
                        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="table table-bordered table-hover">
                            <tr>
                                <td colspan="5" style="background-color:#F9F3DF;">
                                    <span style="font-size:12px;text-align:left;"><b>Retention Opportunity Status:</b> Cancelled<b> ({!retOppCancelledCount} records)</b></span>
                                    
                                </td>
                            </tr>
                            <tr>
                                <th width="14%" scope="col" style="text-align:center;vertical-align: middle">Account Plan </th>
                                <th width="13%" scope="col" style="text-align:center;vertical-align: middle">Retention Opportunity Number </th>
                                <th width="16%" scope="col" style="text-align:center;vertical-align: middle">Retention Opportunity Type </th>
                                <th width="43%" scope="col" style="text-align:center;vertical-align: middle">Retention Opportunity</th>
                                <th width="14%" scope="col" style="text-align:center;vertical-align: middle">Potential CRI Points</th>
                            </tr>
                            <apex:repeat var="ao" value="{!retentionOppCancelled}">
                                <tr>
                                    <td width="14%" style="text-align:left;"><a class="link-to-sobject" id="{!ao.accPlanId}" href="#" >{!ao.accPlanName}</a></td>
                                    <td width="13%" style="text-align:center;"><a class="link-to-sobject" id="{!ao.retOptyId}" href="#" >{!ao.retOptyNum}</a></td>
                                    <td width="16%" style="text-align:center;">{!ao.retOptyType}</td>
                                    <td width="43%" style="text-wrap:suppress;text-align:center;">{!ao.retOpty}</td>
                                    <td width="14%" style="text-align:right;">{!ao.potenCRIPts}</td>
                                </tr>
                            </apex:repeat>
                            <tr>
                                <td width="14%" style="text-align:left;"><b>Total</b></td>
                                <td width="13%" style="text-align:left;"></td>
                                <td width="16%" style="text-align:left;"></td>
                                <td width="43%" style="text-wrap:suppress;text-align:left;"></td>
                                <td width="14%" style="text-align:right;"><b>{!cancelledRetOpty}</b></td>
                            </tr>
                        </table>
                        <div class="page-break"></div>
                        <div class="hide-for-web" style="height:30px"></div>
                    </apex:outputPanel>
                    
                    <!-- ------------------------------------------------------------ACTION PLAN SECTION----------------------------------------------- -->
                    <apex:outputPanel rendered="{!displayActionPlanProgress || displayActionPlanCompleted || displayActionPlanNotStarted || displayActionPlanCancelled}">
                        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="table table-bordered table-hover">
                            <tr>
                                <td class="highlight" colspan="5" style="text-align:left;">
                                    <h3 class="pad-left">Action Plans</h3>
                                </td>
                            </tr>
                            <tr style="{!IF(!displayActionPlanProgress,'display:none','')}">
                                <td colspan="5" style="background-color:#F9F3DF;">
                                    <span style="font-size:12px;text-align:left;"><b>Action Plan Status:</b> In Progress<b> ({!actPlanProgCount} records)</b></span>
                                </td>
                            </tr>
                            <tr style="{!IF(!displayActionPlanProgress,'display:none','')}">
                                <th width="14%" scope="col" style="text-align:center;vertical-align: middle">Account Plan </th>
                                <th width="13%" scope="col" style="text-align:center;vertical-align: middle">Action Plan Number </th>
                                <th width="16%" scope="col" style="text-align:center;vertical-align: middle">Action Type</th>
                                <th width="37%" scope="col" style="text-align:center;vertical-align: middle">Action</th>
                                <th width="14%" scope="col" style="text-align:center;vertical-align: middle">Action Target Completion</th>
                            </tr>
                            <apex:repeat var="ao" value="{!actionPlanProgress}" rendered="{!displayActionPlanProgress}">
                                <tr>
                                    <td width="14%" style="text-align:left;">
                                        <apex:outputLink value="{!URLFOR($Action.Account_Planning__c.View, ao.Account_Plan__c)}" target="_blank"  >{!ao.Account_Plan__r.Name}</apex:outputLink>                   
                                    </td>
                                    <td width="13%" style="text-align:center;">           
                                        <apex:outputLink value="{!URLFOR($Action.Action_Plan__c.View, ao.Id)}" target="_blank"  >{!ao.Name}</apex:outputLink>                   
                                    </td>
                                    <td width="16%" style="text-align:center;">{!ao.Action_Type__c}</td>
                                    <td width="43%" style="text-wrap:suppress;text-align:center;">{!ao.Action__c}</td>
                                    <td width="14%" style="text-align:center;">
                                        <apex:outputText value="{0,date,MM'/'dd'/'yyyy}">
                                            <apex:param value="{!ao.Action_Target_Completion__c}" />
                                        </apex:outputText>
                                    </td>
                                </tr>
                            </apex:repeat>
                        </table>
                        <div class="page-break"></div>
                        <div class="hide-for-web" style="height:30px"></div>
                    </apex:outputPanel>
                    
                    <apex:outputPanel rendered="{!displayActionPlanNotStarted}">
                        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="table table-bordered table-hover">
                            <tr>
                                <td colspan="5" style="background-color:#F9F3DF;">
                                    <span style="font-size:12px;text-align:left;"><b>Action Plan Status:</b> Not Started<b> ({!actPlanNotStartedCount} records)</b></span>
                                </td>
                            </tr>
                            <tr>
                                <th width="14%" scope="col" style="text-align:center;vertical-align: middle">Account Plan </th>
                                <th width="13%" scope="col" style="text-align:center;vertical-align: middle">Action Plan Number </th>
                                <th width="16%" scope="col" style="text-align:center;vertical-align: middle">Action Type</th>
                                <th width="43%" scope="col" style="text-align:center;vertical-align: middle">Action</th>
                                <th width="14%" scope="col" style="text-align:center;vertical-align: middle">Action Target Completion</th>
                            </tr>
                            <apex:repeat var="ao" value="{!actionPlanNotStarted}">
                                <tr>
                                         <td width="14%" style="text-align:left;">
                                        <apex:outputLink value="{!URLFOR($Action.Account_Planning__c.View, ao.Account_Plan__c)}" target="_blank"  >{!ao.Account_Plan__r.Name}</apex:outputLink>                   
                                    </td>
                                    <td width="13%" style="text-align:center;">           
                                        <apex:outputLink value="{!URLFOR($Action.Action_Plan__c.View, ao.Id)}" target="_blank"  >{!ao.Name}</apex:outputLink>                   
                                    </td>
                                    <td width="16%" style="text-align:center;">{!ao.Action_Type__c}</td>
                                    <td width="43%" style="text-wrap:suppress;text-align:center;">{!ao.Action__c}</td>
                                    <td width="14%" style="text-align:center;">
                                        <apex:outputText value="{0,date,MM'/'dd'/'yyyy}">
                                            <apex:param value="{!ao.Action_Target_Completion__c}" />
                                        </apex:outputText>
                                    </td>
                                </tr>
                            </apex:repeat>
                        </table>
                        <div class="page-break"></div>
                        <div class="hide-for-web" style="height:30px"></div>
                    </apex:outputPanel>
                    
                    <apex:outputPanel rendered="{!displayActionPlanCompleted}">
                        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="table table-bordered table-hover topSpace">
                            <tr>
                                <td colspan="5" style="background-color:#F9F3DF;">
                                    <span style="font-size:12px;text-align:left;"><b>Action Plan Status:</b> Completed<b> ({!actPlanCompletedCount} records)</b></span>
                                </td>
                            </tr>
                            <tr>
                                <th width="14%" scope="col" style="text-align:center;vertical-align: middle">Account Plan </th>
                                <th width="13%" scope="col" style="text-align:center;vertical-align: middle">Action Plan Number </th>
                                <th width="16%" scope="col" style="text-align:center;vertical-align: middle">Action Type</th>
                                <th width="43%" scope="col" style="text-align:center;vertical-align: middle">Action</th>
                                <th width="14%" scope="col" style="text-align:center;vertical-align: middle">Action Target Completion</th>
                            </tr>
                            <apex:repeat var="ao" value="{!actionPlanCompleted}">
                                <tr>
     <td width="14%" style="text-align:left;">
                                        <apex:outputLink value="{!URLFOR($Action.Account_Planning__c.View, ao.Account_Plan__c)}" target="_blank"  >{!ao.Account_Plan__r.Name}</apex:outputLink>                   
                                    </td>
                                    <td width="13%" style="text-align:center;">           
                                        <apex:outputLink value="{!URLFOR($Action.Action_Plan__c.View, ao.Id)}" target="_blank"  >{!ao.Name}</apex:outputLink>                   
                                    </td>
                                    <td width="16%" style="text-align:center;">{!ao.Action_Type__c}</td>
                                    <td width="43%" style="text-wrap:suppress;text-align:center;">{!ao.Action__c}</td>
                                    <td width="14%" style="text-align:center;">
                                        <apex:outputText value="{0,date,MM'/'dd'/'yyyy}">
                                            <apex:param value="{!ao.Action_Target_Completion__c}" />
                                        </apex:outputText>
                                    </td>
                                </tr>
                            </apex:repeat>
                        </table>
                        <div class="page-break"></div>
                        <div class="hide-for-web" style="height:30px"></div>                        
                    </apex:outputPanel>
                    
                    <apex:outputPanel rendered="{!displayActionPlanCancelled}">

                        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="table table-bordered table-hover">
                            <tr>
                                <td colspan="5" style="background-color:#F9F3DF;">
                                    <span style="font-size:12px;text-align:left;"><b>Action Plan Status:</b> Cancelled<b> ({!actPlanCancelledCount} records)</b></span>
                                </td>
                            </tr>
                            <tr>
                                <th width="14%" scope="col" style="text-align:center;vertical-align: middle">Account Plan </th>
                                <th width="13%" scope="col" style="text-align:center;vertical-align: middle">Action Plan Number </th>
                                <th width="16%" scope="col" style="text-align:center;vertical-align: middle">Action Type</th>
                                <th width="43%" scope="col" style="text-align:center;vertical-align: middle">Action</th>
                                <th width="14%" scope="col" style="text-align:center;vertical-align: middle">Action Target Completion</th>
                            </tr>
                            <apex:repeat var="ao" value="{!actionPlanCancelled}">
                                <tr>
                                         <td width="14%" style="text-align:left;">
                                        <apex:outputLink value="{!URLFOR($Action.Account_Planning__c.View, ao.Account_Plan__c)}" target="_blank"  >{!ao.Account_Plan__r.Name}</apex:outputLink>                   
                                    </td>
                                    <td width="13%" style="text-align:center;">           
                                        <apex:outputLink value="{!URLFOR($Action.Action_Plan__c.View, ao.Id)}" target="_blank"  >{!ao.Name}</apex:outputLink>                   
                                    </td>
                                    <td width="16%" style="text-align:center;">{!ao.Action_Type__c}</td>
                                    <td width="43%" style="text-wrap:suppress;text-align:center;">{!ao.Action__c}</td>
                                    <td width="14%" style="text-align:center;">
                                        <apex:outputText value="{0,date,MM'/'dd'/'yyyy}">
                                            <apex:param value="{!ao.Action_Target_Completion__c}" />
                                        </apex:outputText>
                                    </td>
                                </tr>
                            </apex:repeat>
                        </table>
                        <div class="page-break"></div>
                        <div class="hide-for-web" style="height:30px"></div>                        
                    </apex:outputPanel>
                 <!-- ------------------------------------------------------------Reports/Dashboards----------------------------------------------- -->
               
                    <table width="100%" border="0" cellspacing="0" cellpadding="0" class="table table-bordered table-hover">
                        <tr>
                            <td colspan="5" style="background-color:#F9F3DF;">
                                <span style="font-size:14px;text-align:left;"><b>Reports/Dashboards</b></span>
                            </td>
                        </tr>
                        <ul class="favorites-content">
                            <apex:repeat var="fav" value="{!favURLList}">
                                <tr>
                                    <td width="40%" style="text-align:left;">
                                        <apex:outputLink styleClass="" target="_blank" value="{!fav.favoriteURL}">{!fav.name} </apex:outputLink>
                                    </td>
                                    
                                </tr>
                            </apex:repeat>   
                        </ul>                         
                    </table>
                 
             <!--------------->
                 </div>
           
               
                
                
                
                
                <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
                <script src="https://www.google.com/jsapi"></script>
                <script src="//cdnjs.cloudflare.com/ajax/libs/numeral.js/1.4.5/numeral.min.js"></script>
                <script>
                    
                    $(document).ready(function() {
                    
                    function linkToSobjectClickHandler(e) {
                        e.preventDefault();
                        var sobjectId = $(this).attr('id');
                        if(typeof sforce !== 'undefined') {
                            sforce.one.navigateToSObject(sobjectId);
                        } else {
                            document.location = '/' + sobjectId;
                        }
                    }
                    
                    $('.link-to-sobject').on('click', linkToSobjectClickHandler);
                    
                    $('.js-change-amt').each(function() {
                        var amt = parseInt($(this).attr('data-amt'));
                        if(amt > 0) {
                            $(this).prepend('+').addClass('pos-value');
                        } else {
                            $(this).addClass('neg-value');
                        };
                    });
                    window.onBeforePrint = function() {
                        printing = true;
                        drawPieChart();
                        drawBarChart();
                        drawBarTotalChart();
                    };
                    
                    function convertToPercent(dec) {
                        var perc = (dec * 100);
                        return perc.toFixed(1) + '%';
                    };
                    var totSales = {!ytdCommercials} + {!ytdPartsndSupplies} + {!ytdResEquipment};
                    var comSales = convertToPercent({!ytdCommercials} / totSales);
                                                    var PSSales = convertToPercent({!ytdPartsndSupplies} / totSales);
                                                    var resEquipSales = convertToPercent({!ytdResEquipment} / totSales);
                                                    $('.comSales').text(comSales);
                    $('.PSSales').text(PSSales);
                    $('.resEquipSales').text(resEquipSales);
                    
                });
                
                var printing = false, chartWidth = '100%', chartHeight = '100%', formatTreshold = 800080;
                
                // Load the Visualization API and the piechart package.
                google.load('visualization', '1.0', {'packages':['corechart']});
                
                // Set a callback to run when the Google Visualization API is loaded.
                google.setOnLoadCallback(drawPieChart);
                google.setOnLoadCallback(drawBarChart);
                google.setOnLoadCallback(drawBarTotalChart);
                
                function drawBarChart() {
                    if(printing) {
                        chartWidth = 400;
                        chartHeight = 200;
                        formatTreshold = 300000
                    }
                    function formatVAxis(formatTreshold) {
                        var ytdSales = ({!ISBLANK(ytdSales)}) ? 0 : {!ytdSales};
                        var previuosYearsYTDSales = ({!ISBLANK(previuosYearsYTDSales)}) ? 0 : {!previuosYearsYTDSales};
                        if(ytdSales > formatTreshold || previuosYearsYTDSales > formatTreshold) {
                            return '$####.##M';
                        } else {
                            return '$#,###';
                        }
                    }
                    function formatSales(num, formatTreshold) {
                        var ytdSales = ({!ISBLANK(ytdSales)}) ? 0 : {!ytdSales};
                        var previuosYearsYTDSales = ({!ISBLANK(previuosYearsYTDSales)}) ? 0 : {!previuosYearsYTDSales};
                        if(ytdSales > formatTreshold || previuosYearsYTDSales > formatTreshold) {
                            return num / 1000000;
                        } else {
                            return num;
                        }
                    }
                    
                    var chartData = new google.visualization.DataTable();
                    chartData.addColumn('string', 'Year');
                    chartData.addColumn('number', 'Sales');
                    chartData.addColumn({type: 'string', role: 'tooltip'});
                    chartData.addRows([
                        ['Current Year', formatSales({!ytdSales}, formatTreshold), '<apex:outputText value="{0,number,$#,###.##}"><apex:param value="{!ytdSales}" /></apex:outputText>'],
                        ['Previous Year', formatSales({!previuosYearsYTDSales}, formatTreshold), '<apex:outputText value="{0,number,$#,###.##}"><apex:param value="{!previuosYearsYTDSales}" /></apex:outputText>']
                    ]);
                    
                    var data = google.visualization.arrayToDataTable([
                        ['Year', 'Sales'],
                        ['A', 123456],
                        ['B', 234567]
                    ]);
                    
                    var options = {
                        'width':chartWidth,
                        'height':chartHeight,
                        'fontName':'Verdana',
                        vAxis: {baseline: 0, format: formatVAxis(formatTreshold) },
                        colors: ['#3498db'],
                        legend: {position: 'none'}
                    };
                    
                    var barChart = new google.visualization.ColumnChart(document.getElementById('barchart'));
                    barChart.draw(chartData, options);
                }
                
                function drawBarTotalChart() {
                    if(printing) {
                        chartWidth = 400;
                        chartHeight = 200;
                        formatTreshold = 300000
                    }
                    
                    function formatVAxis(formatTreshold) {
                        var previousThreeYearsTotalSales = ({!ISBLANK(previousThreeYearsTotalSales)}) ? 0 : {!previousThreeYearsTotalSales};
                        var previousTwoYearsTotalSales = ({!ISBLANK(previousTwoYearsTotalSales)}) ? 0 : {!previousTwoYearsTotalSales};
                        var previousYearTotalSales = ({!ISBLANK(previousYearTotalSales)}) ? 0 : {!previousYearTotalSales};
                        if(previousThreeYearsTotalSales > formatTreshold || previousTwoYearsTotalSales > formatTreshold || previousYearTotalSales > formatTreshold){
                            return '$####.##M'; }
                        else { return '$#,###'; }
                    }
                    
                    function formatTotalSales(num, formatTreshold) {
                        var previousThreeYearsTotalSales = ({!ISBLANK(previousThreeYearsTotalSales)}) ? 0 : {!previousThreeYearsTotalSales};
                        var previousTwoYearsTotalSales = ({!ISBLANK(previousTwoYearsTotalSales)}) ? 0 : {!previousTwoYearsTotalSales};
                        var previousYearTotalSales = ({!ISBLANK(previousYearTotalSales)}) ? 0 : {!previousYearTotalSales};
                        if(previousThreeYearsTotalSales > formatTreshold || previousTwoYearsTotalSales > formatTreshold || previousYearTotalSales > formatTreshold){
                            return num / 1000000; }
                        else { return num; }
                    }
                    
                    var chartData2 = new google.visualization.DataTable();
                    chartData2.addColumn('string', 'Year');
                    chartData2.addColumn('number', 'Sales');
                    chartData2.addColumn({type: 'string', role: 'tooltip'});
                    chartData2.addRows([ ['{!preThreeYear} Sales', formatTotalSales({!previousThreeYearsTotalSales}, formatTreshold), '<apex:outputText value="{0,number,$#,###.##}"><apex:param value="{!previousThreeYearsTotalSales}" /></apex:outputText>'], ['{!preTwoYear} Sales', formatTotalSales({!previousTwoYearsTotalSales}, formatTreshold), '<apex:outputText value="{0,number,$#,###.##}"><apex:param value="{!previousTwoYearsTotalSales}" /></apex:outputText>'], ['{!preYear} Sales', formatTotalSales({!previousYearTotalSales}, formatTreshold), '<apex:outputText value="{0,number,$#,###.##}"><apex:param value="{!previousYearTotalSales}" /></apex:outputText>'] ]);
                    
                    var data = google.visualization.arrayToDataTable([ ['Year', 'Sales'], ['A', 123456], ['B', 234567] ]);
                    var options = { 'width':chartWidth, 'height':chartHeight, 'fontName':'Verdana', vAxis: {baseline: 0, format: formatVAxis(formatTreshold) }, colors: ['#3498db'], legend: {position: 'none'}, lineWidth:4, pointShape:'square', pointSize:8};
                    var barChartTotal = new google.visualization.LineChart(document.getElementById('barchartTotal'));
                    barChartTotal.draw(chartData2, options);
                }
                
                // Callback that creates and populates a data table,
                // instantiates the pie chart, passes in the data and
                // draws it.
                function drawPieChart() {
                    
                    if(printing) {
                        chartWidth = 400;
                        chartHeight = 200;
                    }
                    
                    // Create the data table.
                    var data = new google.visualization.DataTable();
                    data.addColumn('string', 'Product');
                    data.addColumn('number', 'Sales');
                    data.addRows([
                        ['YTD - Commercial Sales', {!ytdCommercials}],
                        ['YTD - P&S Sales', {!ytdPartsndSupplies}],
                        ['YTD - Res Equip Sales', {!ytdResEquipment}]
                    ]);
                    
                    // Set chart options
                    var options = {
                        'width':chartWidth,
                        'height':chartHeight,
                        'fontName':'Verdana',
                        'colors':['#e74c3c','#F1C40F','#2ECC71'],
                        'tooltip':{text: 'percentage', showColorCode: true},
                        slices: {0:{color: '#e74c3c'},1:{color: '#F1C40F'},2:{color: '#2ECC71'}},
                        'reverseCategories': true, 'pieStartAngle': 180, legend: {position: 'none'}
                    };
                    
                    // Instantiate and draw our chart, passing in some options.
                    var pieChart = new google.visualization.PieChart(document.getElementById('piechart'));
                    pieChart.draw(data, options);
                }
                </script>
            </body>
        </apex:outputPanel>
    </apex:form>
</apex:page>